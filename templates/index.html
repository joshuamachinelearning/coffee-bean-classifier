<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Bean Quality Classifier</title>
    
    <!-- Local Tailwind CSS -->
    <link href="{{ url_for('static', filename='css/tailwind.css') }}" rel="stylesheet">
    
    <!-- Local Font Awesome -->
    <link href="{{ url_for('static', filename='fonts/fontawesome/css/all.min.css') }}" rel="stylesheet">
    
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    
    <style>
        /* Custom Coffee Colors */
        :root {
            --coffee-100: #f7f3f0;
            --coffee-150: #f0e6d6;
            --coffee-200: #e8d5bb;
            --coffee-300: #d4b896;
            --coffee-400: #c19a6b;
            --coffee-500: #8B4513;
            --coffee-600: #7a3e11;
            --coffee-700: #68360f;
            --coffee-800: #562d0c;
            --coffee-900: #44240a;
        }
        
        /* Background Colors */
        .bg-coffee-50 { background-color: #faf8f5; }
        .bg-coffee-100 { background-color: var(--coffee-100); }
        .bg-coffee-150 { background-color: var(--coffee-150); }
        .bg-coffee-200 { background-color: var(--coffee-200); }
        .bg-coffee-300 { background-color: var(--coffee-300); }
        .bg-coffee-400 { background-color: var(--coffee-400); }
        .bg-coffee-500 { background-color: var(--coffee-500); }
        .bg-coffee-600 { background-color: var(--coffee-600); }
        .bg-coffee-700 { background-color: var(--coffee-700); }
        .bg-coffee-800 { background-color: var(--coffee-800); }
        .bg-coffee-900 { background-color: var(--coffee-900); }
        
        /* Text Colors */
        .text-coffee-100 { color: var(--coffee-100); }
        .text-coffee-200 { color: var(--coffee-200); }
        .text-coffee-300 { color: var(--coffee-300); }
        .text-coffee-400 { color: var(--coffee-400); }
        .text-coffee-500 { color: var(--coffee-500); }
        .text-coffee-600 { color: var(--coffee-600); }
        .text-coffee-700 { color: var(--coffee-700); }
        .text-coffee-800 { color: var(--coffee-800); }
        .text-coffee-900 { color: var(--coffee-900); }
        
        /* Border Colors */
        .border-coffee-200 { border-color: var(--coffee-200); }
        .border-coffee-300 { border-color: var(--coffee-300); }
        .border-coffee-500 { border-color: var(--coffee-500); }
        .border-coffee-600 { border-color: var(--coffee-600); }
        
        /* Hover States */
        .hover\:bg-coffee-50:hover { background-color: #faf8f5; }
        .hover\:bg-coffee-600:hover { background-color: var(--coffee-600); }
        .hover\:border-coffee-500:hover { border-color: var(--coffee-500); }
        
        /* Gradients */
        .bg-gradient-to-br {
            background-image: linear-gradient(to bottom right, var(--tw-gradient-stops));
        }
        .bg-gradient-to-r {
            background-image: linear-gradient(to right, var(--tw-gradient-stops));
        }
        .from-coffee-100 {
            --tw-gradient-from: var(--coffee-100);
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(247, 243, 240, 0));
        }
        .to-coffee-200 {
            --tw-gradient-to: var(--coffee-200);
        }
        .from-coffee-500 {
            --tw-gradient-from: var(--coffee-500);
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(139, 69, 19, 0));
        }
        .to-coffee-600 {
            --tw-gradient-to: var(--coffee-600);
        }
        .from-coffee-50 {
            --tw-gradient-from: #faf8f5;
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(250, 248, 245, 0));
        }
        
        /* Custom Animations */
        @keyframes pulse-glow {
            0%, 100% { 
                transform: scale(1); 
                opacity: 0.8; 
            }
            50% { 
                transform: scale(1.05); 
                opacity: 1; 
            }
        }
        
        @keyframes bounce-gentle {
            0%, 100% { 
                transform: translateY(0);
            }
            50% { 
                transform: translateY(-10px);
            }
        }
        
        @keyframes progress-fill {
            0% { 
                width: 0%; 
            }
            100% { 
                width: var(--progress-width); 
            }
        }
        
        @keyframes slide-up {
            0% { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        /* Animation Classes */
        .animate-pulse-glow { 
            animation: pulse-glow 2s ease-in-out infinite; 
        }
        .animate-bounce-gentle {
            animation: bounce-gentle 2s ease-in-out infinite;
        }
        .animate-progress-fill { 
            animation: progress-fill 1.5s ease-out forwards; 
        }
        .animate-slide-up { 
            animation: slide-up 0.5s ease-out forwards; 
        }
        
        /* Progress Bar Animation */
        .progress-bar {
            transition: width 1.5s cubic-bezier(0.4, 0.0, 0.2, 1);
        }
        
        /* Border Width Classes */
        .border-3 {
            border-width: 3px;
        }
        .border-4 {
            border-width: 4px;
        }

        @keyframes coffee-brew {
        0%, 100% { transform: translate(-50%, -50%) rotate(0deg) scale(1); }
        25% { transform: translate(-50%, -50%) rotate(-5deg) scale(1.05); }
        50% { transform: translate(-50%, -50%) rotate(5deg) scale(1.1); }
        75% { transform: translate(-50%, -50%) rotate(-3deg) scale(1.05); }
        }

        .animate-coffee-brew {
        animation: coffee-brew 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-coffee-100 to-coffee-200 min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-coffee-500">
        <div class="container mx-auto px-4 py-6 text-center">
            <h1 class="text-4xl font-bold text-coffee-800 mb-2">
                <i class="fas fa-seedling text-coffee-600 mr-3"></i>
                Coffee Bean Quality Classifier
            </h1>
            <p class="text-coffee-600 text-lg mb-4">
                Upload images to determine if your coffee beans are good or bad quality
            </p>
            
            <!-- Model Selection Section -->
            <div class="bg-coffee-50 inline-block px-6 py-4 rounded-xl border border-coffee-200 mb-4">
                <div class="flex items-center justify-center space-x-4">
                    <div>
                        <label for="model-select" class="text-coffee-700 font-medium text-sm">Select Model:</label>
                        <select id="model-select" class="ml-2 px-3 py-1 border border-coffee-300 rounded-lg text-coffee-700 bg-white focus:outline-none focus:ring-2 focus:ring-coffee-500">
                            {% if available_models %}
                                {% for model in available_models %}
                                <option value="{{ model.filename }}" 
                                        data-type="{{ model.type }}" 
                                        data-size="{{ model.img_size }}"
                                        {% if model.filename == current_model_name %}selected{% endif %}>
                                    {{ model.name }} ({{ model.type|title }}, {{ model.img_size }}x{{ model.img_size }})
                                </option>
                                {% endfor %}
                            {% else %}
                                <option value="">No models found</option>
                            {% endif %}
                        </select>
                    </div>
                    <div id="model-info" class="text-coffee-600">
                        <i class="fas fa-brain text-coffee-500 mr-2"></i>
                        <span class="font-medium">Current: <span id="current-model-display">{{ current_model_name or 'No model loaded' }}</span></span>
                        {% if current_img_size %}
                        <span class="text-coffee-500 ml-2">| Size: <span id="current-size-display">{{ current_img_size }}x{{ current_img_size }}</span></span>
                        <span class="text-coffee-500 ml-2">| Type: <span id="current-type-display">{{ current_model_type|title or 'Unknown' }}</span></span>
                        {% endif %}
                    </div>
                </div>
                
                <!-- No models warning -->
                {% if not available_models %}
                <div class="mt-4 bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        <div>
                            <p class="font-medium">No models found!</p>
                            <p class="text-sm mt-1">Please place your model files (.h5 or .keras) in the 'models' directory.</p>
                            <p class="text-xs mt-1 text-yellow-600">Expected: models/coffee_densenet169.h5, models/coffee_custom.keras, etc.</p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Model Loading Indicator -->
            <div id="model-loading" class="hidden bg-coffee-50 border border-coffee-200 text-coffee-700 px-4 py-2 rounded-lg mb-4 inline-block">
                <i class="fas fa-spinner animate-spin mr-2"></i>
                Loading model...
            </div>
        </div>
    </header>

    <!-- Main Upload Section -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8 border-t-4 border-coffee-500">
            <div id="upload-area" class="border-3 border-dashed border-coffee-300 rounded-xl p-12 transition-all duration-300 hover:border-coffee-500 hover:bg-coffee-50 cursor-pointer text-center">
                <i id="upload-icon" class="fas fa-cloud-upload-alt text-6xl text-coffee-400 mb-4 transition-transform duration-300 hover:animate-bounce-gentle"></i>
                <h3 class="text-2xl font-semibold text-coffee-700 mb-2">Upload Your Coffee Bean Images</h3>
                <p class="text-coffee-500 mb-6">Drag and drop images here or click to browse</p>
                <p class="text-sm text-coffee-400 mb-6">Supported formats: JPG, PNG, GIF â€¢ Max size: 10MB per file</p>
                <input type="file" id="file-input" accept="image/*" multiple class="hidden">
                <button id="browse-btn" class="bg-coffee-500 hover:bg-coffee-600 text-white px-8 py-3 rounded-lg font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-folder-open mr-2"></i>
                    Browse Files
                </button>
            </div>

            <!-- Enhanced Loading Spinner -->
            <div id="loading" class="hidden mt-8">
                <div class="bg-coffee-50 rounded-2xl p-8 border border-coffee-200">
                    <div class="text-center">
                        <div class="flex justify-center items-center mb-6">
                            <div class="relative w-20 h-20">
                                <!-- Outer spinning ring -->
                                <div class="absolute inset-0 rounded-full border-4 border-coffee-200 border-t-transparent animate-spin"></div>
                                <!-- Inner spinning ring -->
                                <div class="absolute inset-0 rounded-full rounded-full ring-4 ring-coffee-500 ring-t-transparent animate-spin"></div>
                                <!-- Coffee cup icon with brewing animation -->
                                <i class="fas fa-coffee absolute top-1/2 left-1/2 text-coffee-600 text-3xl animate-coffee-brew"></i>
                            </div>
                        </div>

                        <h3 class="text-xl font-semibold text-coffee-700 mb-3">Analyzing Your Coffee Beans</h3>
                        <div class="space-y-2 text-coffee-600">
                            <div class="flex items-center justify-center">
                                <div class="w-2 h-2 bg-coffee-400 rounded-full animate-bounce mr-1"></div>
                                <div class="w-2 h-2 bg-coffee-400 rounded-full animate-bounce mr-1" style="animation-delay: 0.1s"></div>
                                <div class="w-2 h-2 bg-coffee-400 rounded-full animate-bounce mr-3" style="animation-delay: 0.2s"></div>
                                <span id="loading-text">Preprocessing images</span>
                            </div>
                        </div>
                        <div class="mt-6">
                            <div class="bg-coffee-200 rounded-full h-2 overflow-hidden">
                                <div id="progress-bar" class="bg-gradient-to-r from-coffee-500 to-coffee-600 h-2 rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div>
                            </div>
                            <p class="text-sm text-coffee-500 mt-2">This may take a few moments...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="error-message" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg shadow-lg mt-6 animate-slide-up">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle text-xl mr-3"></i>
                    <div>
                        <h4 class="font-semibold">Error</h4>
                        <p id="error-text"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden mt-8 animate-slide-up">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-coffee-800">
                    <i class="fas fa-chart-bar mr-2"></i>Analysis Results
                </h2>
                <button id="analyze-another" class="bg-coffee-500 hover:bg-coffee-600 text-white px-6 py-2 rounded-lg font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-plus mr-2"></i>Analyze Another
                </button>
            </div>
            <div class="grid gap-6" id="results-container"></div>
            
            <!-- Model Info -->
            <div class="mt-8 bg-gradient-to-r from-coffee-100 to-coffee-150 rounded-2xl p-6 border border-coffee-200">
                <div class="flex items-center justify-center text-center">
                    <div class="mr-4">
                        <i class="fas fa-info-circle text-coffee-500 text-2xl"></i>
                    </div>
                    <div id="results-model-info">
                        <h4 class="font-semibold text-coffee-800">Model Information</h4>
                        <p class="text-coffee-600 text-sm">
                            Classification powered by <span id="results-model-name">{{ current_model_name or 'Unknown' }}</span> neural network
                        </p>
                        <p class="text-coffee-500 text-xs mt-1">
                            Input size: <span id="results-model-size">{{ current_img_size or 224 }}x{{ current_img_size or 224 }}</span> pixels |
                            Type: <span id="results-model-type">{{ current_model_type|title or 'Unknown' }}</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-coffee-800 text-coffee-100 py-8 mt-12 text-center">
        <p class="text-lg"><i class="fas fa-coffee mr-2"></i>Powered by Deep Learning & Machine Learning</p>
        <p class="text-coffee-300 mt-2">Quality coffee starts with quality beans</p>
    </footer>

    <script>
        // DOM elements
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');
        const uploadIcon = document.getElementById('upload-icon');
        const browseBtn = document.getElementById('browse-btn');
        const loading = document.getElementById('loading');
        const loadingText = document.getElementById('loading-text');
        const progressBar = document.getElementById('progress-bar');
        const errorMessage = document.getElementById('error-message');
        const resultsDiv = document.getElementById('results');
        const resultsContainer = document.getElementById('results-container');
        const analyzeAnotherBtn = document.getElementById('analyze-another');
        
        // Model selection elements
        const modelSelect = document.getElementById('model-select');
        const modelLoading = document.getElementById('model-loading');
        const currentModelDisplay = document.getElementById('current-model-display');
        const currentSizeDisplay = document.getElementById('current-size-display');
        const currentTypeDisplay = document.getElementById('current-type-display');

        // Loading states
        const loadingStates = [
            { text: "Preprocessing images", progress: 20 },
            { text: "Loading neural network", progress: 40 },
            { text: "Extracting features", progress: 60 },
            { text: "Running classification", progress: 80 },
            { text: "Finalizing results", progress: 100 }
        ];

        // Model selection handler
        modelSelect.addEventListener('change', async function() {
            const selectedOption = this.options[this.selectedIndex];
            const modelFilename = selectedOption.value;
            const modelType = selectedOption.dataset.type;
            const modelSize = selectedOption.dataset.size;
            
            if (!modelFilename) return;
            
            // Show loading
            modelLoading.classList.remove('hidden');
            modelSelect.disabled = true;
            
            try {
                const response = await fetch('/api/select-model', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model_filename: modelFilename
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Update display
                    currentModelDisplay.textContent = data.model.name;
                    currentSizeDisplay.textContent = `${data.model.img_size}x${data.model.img_size}`;
                    currentTypeDisplay.textContent = data.model.type.charAt(0).toUpperCase() + data.model.type.slice(1);
                    
                    // Clear any previous results
                    hideResults();
                    hideError();
                } else {
                    showError(data.error || 'Failed to load model');
                }
            } catch (error) {
                console.error('Error selecting model:', error);
                showError('Network error when loading model');
            } finally {
                modelLoading.classList.add('hidden');
                modelSelect.disabled = false;
            }
        });

        // Open file dialog on browse button click
        browseBtn.addEventListener('click', (e) => {
            e.preventDefault();
            fileInput.click();
        });

        // Analyze another button
        analyzeAnotherBtn.addEventListener('click', () => {
            hideResults();
            hideError();
            fileInput.value = '';
            uploadArea.scrollIntoView({ behavior: 'smooth' });
        });

        // Drag & drop events with proper bounce animation
        uploadArea.addEventListener('dragover', e => {
            e.preventDefault();
            uploadArea.classList.add('border-coffee-500', 'bg-coffee-50');
            uploadIcon.classList.add('animate-bounce');
        });
        
        uploadArea.addEventListener('dragleave', e => {
            e.preventDefault();
            uploadArea.classList.remove('border-coffee-500', 'bg-coffee-50');
            uploadIcon.classList.remove('animate-bounce');
        });
        
        uploadArea.addEventListener('drop', e => {
            e.preventDefault();
            uploadArea.classList.remove('border-coffee-500', 'bg-coffee-50');
            uploadIcon.classList.remove('animate-bounce');
            handleFiles(Array.from(e.dataTransfer.files));
        });

        // Click on empty area opens file dialog (not button)
        uploadArea.addEventListener('click', (e) => {
            if (e.target !== browseBtn && !browseBtn.contains(e.target)) {
                fileInput.click();
            }
        });

        // Hover animation for upload icon
        uploadArea.addEventListener('mouseenter', () => {
            if (!uploadIcon.classList.contains('animate-bounce')) {
                uploadIcon.classList.add('animate-bounce');
            }
        });

        uploadArea.addEventListener('mouseleave', () => {
            if (!uploadArea.classList.contains('border-coffee-500')) {
                uploadIcon.classList.remove('animate-bounce');
            }
        });

        // File input change
        fileInput.addEventListener('change', e => {
            handleFiles(Array.from(e.target.files));
        });

        function handleFiles(files) {
            hideError();
            hideResults();
            if (!files.length) return;

            const validFiles = [];
            const invalidFiles = [];

            files.forEach(file => {
                if (!file.type.startsWith('image/')) {
                    invalidFiles.push(`${file.name}: Invalid file type`);
                } else if (file.size > 10 * 1024 * 1024) { // 10MB limit
                    invalidFiles.push(`${file.name}: File too large (max 10MB)`);
                } else {
                    validFiles.push(file);
                }
            });

            if (invalidFiles.length) {
                showError(invalidFiles.join('\n'));
            }
            
            if (!validFiles.length) return;

            uploadFiles(validFiles);
        }

        function uploadFiles(files) {
            showLoading();
            simulateLoadingProgress();
            
            const formData = new FormData();
            files.forEach(file => formData.append('files', file));

            fetch('/predict', { 
                method: 'POST', 
                body: formData 
            })
            .then(res => {
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                return res.json();
            })
            .then(data => {
                // Add a small delay to show completion
                setTimeout(() => {
                    hideLoading();
                    if (data.error) {
                        showError(data.error);
                    } else {
                        showResults(data);
                        // Update model info in results
                        if (data.model_info) {
                            updateResultsModelInfo(data.model_info);
                        }
                    }
                }, 500);
            })
            .catch(err => {
                hideLoading();
                showError('Error processing images. Please try again.');
                console.error('Upload error:', err);
            });
        }

        function simulateLoadingProgress() {
            let currentState = 0;
            const interval = setInterval(() => {
                if (currentState < loadingStates.length) {
                    const state = loadingStates[currentState];
                    loadingText.textContent = state.text;
                    progressBar.style.width = `${state.progress}%`;
                    currentState++;
                } else {
                    clearInterval(interval);
                }
            }, 800);
        }

        function updateResultsModelInfo(modelInfo) {
            const modelNameEl = document.getElementById('results-model-name');
            const modelSizeEl = document.getElementById('results-model-size');
            const modelTypeEl = document.getElementById('results-model-type');
            
            if (modelNameEl) modelNameEl.textContent = modelInfo.name;
            if (modelSizeEl) modelSizeEl.textContent = `${modelInfo.img_size}x${modelInfo.img_size}`;
            if (modelTypeEl) modelTypeEl.textContent = modelInfo.type.charAt(0).toUpperCase() + modelInfo.type.slice(1);
        }

        function showResults(data) {
            resultsContainer.innerHTML = '';
            
            data.results.forEach((result, index) => {
                const div = document.createElement('div');
                div.className = 'bg-white rounded-2xl shadow-xl p-6 border-t-4 border-coffee-500 grid md:grid-cols-2 gap-6 animate-slide-up';
                div.style.animationDelay = `${index * 0.1}s`;

                if (result.error) {
                    div.innerHTML = `
                        <div class="md:col-span-2 flex items-center space-x-4">
                            <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
                            <div>
                                <h3 class="font-semibold text-coffee-800">${result.filename}</h3>
                                <p class="text-red-600">${result.error}</p>
                            </div>
                        </div>
                    `;
                } else {
                    const confidencePercent = parseFloat(result.confidence);
                    const isGoodBean = result.predicted_class === 'Good Coffee Bean';
                    
                    div.innerHTML = `
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-coffee-700 mb-3">
                                <i class="fas fa-image mr-2"></i>${result.filename}
                            </h3>
                            <div class="bg-coffee-50 rounded-xl p-4 shadow-inner">
                                <img src="${result.image}" class="max-w-full h-auto rounded-lg mx-auto max-h-64 shadow-md" alt="Uploaded coffee bean image">
                            </div>
                        </div>
                        <div class="flex flex-col justify-center">
                            <div class="bg-gradient-to-br from-coffee-50 to-coffee-100 rounded-xl p-6 shadow-inner space-y-6">
                                <div class="text-center">
                                    <div class="mb-4">
                                        <i class="fas ${isGoodBean ? 'fa-check-circle text-green-500' : 'fa-times-circle text-red-500'} text-4xl"></i>
                                    </div>
                                    <span class="font-bold text-xl px-4 py-2 rounded-full ${isGoodBean ? 'bg-green-100 text-green-800 border border-green-300' : 'bg-red-100 text-red-800 border border-red-300'}">
                                        ${result.predicted_class}
                                    </span>
                                </div>
                                
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="font-medium text-coffee-600">
                                            <i class="fas fa-percentage mr-2"></i>Confidence:
                                        </span>
                                        <span class="font-bold text-coffee-800">${result.confidence}%</span>
                                    </div>
                                    <div class="relative">
                                        <div class="w-full bg-coffee-200 rounded-full h-3 overflow-hidden shadow-inner">
                                            <div class="progress-bar bg-gradient-to-r from-coffee-500 to-coffee-600 h-3 rounded-full shadow-sm" 
                                                 style="width: 0%; --progress-width: ${confidencePercent}%"></div>
                                        </div>
                                        <div class="absolute inset-0 rounded-full border border-coffee-300"></div>
                                    </div>
                                </div>
                                
                                <div class="text-center pt-4 border-t border-coffee-200">
                                    <p class="text-sm text-coffee-600">
                                        <i class="fas fa-lightbulb mr-1"></i>
                                        ${isGoodBean ? 
                                            'These beans appear to be high quality!' : 
                                            'These beans may have quality issues.'}
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                resultsContainer.appendChild(div);
            });
            
            resultsDiv.classList.remove('hidden');
            
            // Animate confidence bars after a delay
            setTimeout(() => {
                document.querySelectorAll('.progress-bar').forEach(bar => {
                    const width = bar.style.getPropertyValue('--progress-width');
                    bar.style.width = width;
                });
            }, 300);
            
            setTimeout(() => {
                resultsDiv.scrollIntoView({ behavior: 'smooth' });
            }, 500);
        }

        function showLoading() { 
            loading.classList.remove('hidden');
            progressBar.style.width = '0%';
            loadingText.textContent = 'Preprocessing images';
        }
        
        function hideLoading() { 
            loading.classList.add('hidden'); 
        }
        
        function showError(msg) { 
            document.getElementById('error-text').textContent = msg; 
            errorMessage.classList.remove('hidden'); 
        }
        
        function hideError() { 
            errorMessage.classList.add('hidden'); 
        }
        
        function hideResults() { 
            resultsDiv.classList.add('hidden'); 
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch current model info on page load
            fetch('/api/model-info')
                .then(res => res.json())
                .then(data => {
                    if (data.model_loaded) {
                        currentModelDisplay.textContent = data.model_name;
                        currentSizeDisplay.textContent = `${data.img_size}x${data.img_size}`;
                        currentTypeDisplay.textContent = data.model_type ? data.model_type.charAt(0).toUpperCase() + data.model_type.slice(1) : 'Unknown';
                    }
                })
                .catch(err => console.error('Error fetching model info:', err));
        });
    </script>
</body>
</html>